# MCP v3.0 轻量验证版测试计划

## 文档说明

**版本**: v3.0 轻量验证版
**目标**: 快速验证现有MCP功能的可用性
**原则**: 快速优先、兼顾覆盖
**适用**: Revit 2020-2025 + MCP插件

**场景优先级说明**:
- 🔴 **必测**: 核心功能验证，必须执行
- 🟡 **建议**: 深度验证，建议执行
- 🔵 **可选**: 边界和性能测试，时间允许时执行

## 测试总览

| 模块 | 命令 | 场景数 | 验证重点 |
|------|------|--------|----------|
| 信息获取 | get_revit_status | 3 | 基本状态查询 |
| 元素查询 | ai_element_filter | 13 | 过滤和节点数据验证（含名称关键字） |
| 视觉操作 | operate_element_visual | 7 | 选择、着色和组合操作 |
| 可见性控制 | operate_element_visibility | 6 | 隐藏和隔离 |
| 几何变换 | operate_element_transform | 9 | 旋转、镜像、翻转、移动、复制 |
| 参数修改 | operate_element_modify | 7 | 参数设置、删除和中文支持 |
| 元素创建 | create_element | 10 | 基本创建功能 |
| 创建建议 | get_element_creation_suggestion | 5 | 参数建议查询 |
| 端到端验证 | 跨命令流程 | 6 | 组合操作流程 |
| **总计** | **8个MCP命令** | **66个** | **全功能覆盖** |

## 前置准备

### 环境检查

| 检查项 | 要求 | 状态 | 补充方法 |
|--------|------|------|----------|
| Revit版本 | 2020-2025任一版本 | □ | 启动Revit确认 |

### 元素准备

| 元素 | 数量 | 状态 | 快速创建方法 |
|------|------|------|-------------|
| 楼板 | 1块 | □ | 建筑→楼板→矩形 |
| 墙体 | 1面 | □ | 建筑→墙→直线 |
| 门 | 1扇 | □ | 建筑→门→点击墙 |
| 窗 | 1扇 | □ | 建筑→窗→点击墙 |
| 灯具(WorkPlaneBased) | 1个 | □ | 族库→M_吸顶灯→楼板 |
| Pin元素 | 1个 | □ | 选设备→右键→锁定（**说明**：Pin是Revit中的锁定状态，Pin后的元素无法被移动、旋转、镜像等变换操作） |
| 3D视图 | 1个 | □ | 视图→三维视图 |

## 测试执行记录

**使用说明**: 每完成一个场景，在对应行记录结果（✅成功 / ❌失败）

**记录格式**:
- ✅ 功能正常，符合预期
- ❌ 功能异常，记录问题到备注
- ⚠️ 部分功能异常，不影响核心

---

## AM - 信息查询模块

### 1. 信息获取模块（get_revit_status）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| RS-01 | 🔴必测 | 返回当前项目信息 | □ | |
| RS-02 | 🟡建议 | 返回无活动文档状态 | □ | |
| RS-03 | 🟡建议 | 返回所有项目列表 | □ | |

### 2. 元素查询模块（ai_element_filter）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| F-01 | 🔴必测 | 返回所有墙体 | □ | 验证identity节点存在 |
| F-02 | 🔴必测 | 返回指定墙体详情 | □ | 验证精确匹配 |
| F-03 | 🔴必测 | 返回范围内元素 | □ | 验证空间过滤 |
| F-04 | 🔴必测 | 仅返回可见元素 | □ | 切换视图验证 |
| F-05 | 🔴必测 | 仅返回类型 | □ | 验证type/instance区分 |
| F-06 | 🔴必测 | 返回高度参数 | □ | 验证参数提取+内置参数 |
| F-07 | 🔴必测 | 返回错误或空结果 | □ | 验证无效ID处理 |
| F-08 | 🟡建议 | 仅返回几何节点 | □ | **核对要点**：location含point/line，坐标为mm（内部ft×304.8）；**需对照示例值**：如墙体location.line.p0={x:1000, y:2000, z:0}(mm)，验证从内部ft转换 |
| F-09 | 🟡建议 | 返回identity+geometry完整节点 | □ | **核对要点**：包含name、category、elementId、location、boundingBox字段；**需对照示例值**：identity.name="基本墙-200mm"，geometry.boundingBox含min/max点 |
| F-10 | 🟡建议 | 返回嵌套参数结构 | □ | **核对要点**：parameters.instance和parameters.type两个子节点分别存在；**需对照示例值**：parameters.instance.高度=3000，parameters.type.功能=1，确认嵌套结构正确 |
| F-11 | 🟡建议 | 返回空列表，Success=true | □ | **验证空结果也是成功响应** |
| F-12 | 🔴必测 | 根据类型名关键字过滤元素 | □ | **操作步骤**：1) 先执行F-01查询墙体，记录第一个墙的类型名（如"常规-300mm"）；2) 提取关键字（如"300"或"常规"）；3) 使用filterNameKeyword过滤，验证能返回该墙体 |
| F-13 | 🔴必测 | 根据族名关键字过滤族实例 | □ | **操作步骤**：1) 先执行F-01查询门实例，记录族名（如"单扇-平齐"）；2) 提取关键字（如"单扇"）；3) 使用filterNameKeyword+filterCategory="OST_Doors"过滤，验证能返回该门 |

### 3. 视觉操作模块（operate_element_visual）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| V-01 | 🔴必测 | Revit中墙体被选中 | □ | 检查选择集 |
| V-02 | 🔴必测 | 3D剖切框聚焦元素 | □ | 检查3D视图 |
| V-03 | 🔴必测 | 元素高亮闪烁 | □ | 观察高亮效果 |
| V-04 | 🔴必测 | 元素显示红色 | □ | 检查颜色覆盖 |
| V-05 | 🔴必测 | 元素半透明 | □ | 检查透明度 |
| V-06 | 🟡建议 | 有效元素成功，记录失败ID | □ | 检查错误处理 |
| V-07 | 🟡建议 | 颜色和透明度同时生效 | □ | **测试对象**：使用F-01中查询到的第一面墙 |

---

## PM - 控制操作模块

### 4. 可见性控制模块（operate_element_visibility）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| VI-01 | 🔴必测 | 元素在当前视图隐藏 | □ | 检查视图状态 |
| VI-02 | 🔴必测 | 元素临时隐藏 | □ | Undo后恢复 |
| VI-03 | 🔴必测 | 仅显示目标元素 | □ | 其他元素隐藏 |
| VI-04 | 🔴必测 | 恢复隐藏元素 | □ | 元素重新可见 |
| VI-05 | 🔴必测 | 恢复所有元素可见 | □ | 视图恢复正常 |
| VI-06 | 🟡建议 | 返回参数错误 | □ | 验证参数检查 |

### 5. 几何变换模块（operate_element_transform）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| T-01 | 🔴必测 | 灯具方向改变90度 | □ | **轴线定义**：rotateAxis取灯具中心垂直轴（p0=灯具location点，p1=location点向上偏移1000mm），rotateAngle=90（逆时针），如宿主约束无法旋转则记录跳过 |
| T-02 | 🟡建议 | 家具X坐标变为相反数，Y/Z坐标保持不变 | □ | **镜像平面**：origin=家具boundingBox中心点，normal={1,0,0}（YZ平面通过家具中心） |
| T-03 | 🔴必测 | 门水平翻转 | □ | 检查门朝向 |
| T-04 | 🔴必测 | 门前后翻转 | □ | 检查门朝向 |
| T-05 | 🔴必测 | 元素X方向移动1米 | □ | 检查位置变化 |
| T-06 | 🟡建议 | Pin元素操作失败，记录原因 | □ | 验证Pin状态处理 |
| T-07 | 🔵可选 | 返回参数错误 | □ | 验证参数检查 |
| T-08 | 🔵可选 | 返回参数错误或无变化 | □ | 验证零向量处理 |
| T-09 | 🔴必测 | 元素被复制，X方向偏移2米 | □ | 验证返回copiedElements数组包含新元素ID |

### 6. 参数修改模块（operate_element_modify）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| M-01 | 🔴必测 | 参数值更新 | □ | 检查参数界面 |
| M-02 | 🔴必测 | 参数值正确转换（mm→ft） | □ | 验证单位转换 |
| M-03 | 🟡建议 | 内置参数设置成功 | □ | 使用BuiltIn名称 |
| M-04 | 🟡建议 | 操作失败，记录原因 | □ | 验证只读检查 |
| M-05 | 🟡建议 | 操作失败，记录未找到 | □ | 验证参数检查 |
| M-06 | 🔴必测 | 元素删除成功 | □ | 检查元素消失 |
| M-07 | 🟡建议 | 参数值更新 | □ | **测试对象**：使用C-01中创建的墙体，验证中文参数支持 |

---

## AM - 创建模块

### 7. 元素创建模块（create_element）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| C-01 | 🔴必测 | 新墙体生成 | □ | 验证墙体属性 |
| C-02 | 🔴必测 | 新楼板生成 | □ | 验证边界闭合 |
| C-03 | 🔴必测 | 门放置到墙上 | □ | 验证宿主绑定 |
| C-04 | 🔴必测 | 设备放置成功 | □ | 验证点定位 |
| C-05 | 🟡建议 | 自动选择最近标高 | □ | 验证标高选择 |
| C-06 | 🟡建议 | 自动绑定合适宿主 | □ | 验证宿主搜索 |
| C-07 | 🟡建议 | 创建失败，错误提示 | □ | 验证类型检查 |
| C-08 | 🟡建议 | 创建失败，参数错误 | □ | 验证边界检查 |
| C-09 | 🔵可选 | 族放置方向正确 | □ | 验证方向控制 |
| C-10 | 🔵可选 | 全部创建成功，耗时<3秒 | □ | 验证批量性能 |

### 8. 创建建议模块（get_element_creation_suggestion）

| 场景ID | 优先级 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|------|
| GS-01 | 🔴必测 | 返回所有创建建议 | □ | 检查建议完整性 |
| GS-02 | 🔴必测 | 返回墙体创建参数说明 | □ | 验证系统族建议 |
| GS-03 | 🔴必测 | 返回楼板创建参数说明 | □ | 验证楼板建议 |
| GS-04 | 🟡建议 | 返回族创建参数说明 | □ | 验证族建议 |
| GS-05 | 🟡建议 | 返回对应类别建议 | □ | 验证自动判断 |

---

## PM - 综合验证

### 9. 端到端验证（跨命令流程）

| 场景ID | 优先级 | 操作要点 | 预期结果 | 测试结果 | 备注 |
|--------|--------|----------|----------|----------|------|
| E-01 | 🔴必测 | 数据流验证：查询墙体geometry→基于坐标进行视觉标记 | 坐标数据被正确消费 | □ | **必须记录**：location坐标值与实际选中位置一致性 |
| E-02 | 🟡建议 | 创建临时墙→查询验证→删除清理 | 创建删除循环成功 | □ | 验证创建删除闭环 |
| E-03 | 🟡建议 | 隔离结构墙→批量调整位置→恢复显示 | 隔离状态下的批量操作 | □ | 验证可见性+变换组合 |
| E-04 | 🟡建议 | 获取门窗建议→批量创建→检查朝向 | 建议指导标准化创建 | □ | 验证建议的实用性 |
| E-05 | 🟡建议 | 查找超高构件→红色标记→导出列表 | 批量问题标记流程 | □ | 验证批量处理工作流 |
| E-06 | 🔵可选 | Pin元素操作失败→自动跳过→继续处理 | 容错机制正常 | □ | 验证错误恢复能力 |

---

## 测试结果汇总

### 模块通过率统计

| 模块 | 总场景 | 通过 | 失败 | 通过率 | 状态 |
|------|--------|------|------|--------|------|
| 信息获取 | 3 | _ | _ | _% | □ |
| 元素查询 | 13 | _ | _ | _% | □ |
| 视觉操作 | 6 | _ | _ | _% | □ |
| 可见性控制 | 6 | _ | _ | _% | □ |
| 几何变换 | 9 | _ | _ | _% | □ |
| 参数修改 | 6 | _ | _ | _% | □ |
| 元素创建 | 10 | _ | _ | _% | □ |
| 创建建议 | 5 | _ | _ | _% | □ |
| 端到端验证 | 6 | _ | _ | _% | □ |
| **总计** | **66** | **_** | **_** | **_%** | □ |

### 成功标准

- ✅ **功能可用**: 各模块通过率 ≥ 80%
- ✅ **响应合理**: 单操作耗时 < 5秒
- ✅ **错误可控**: 异常场景有明确提示
- ✅ **节点完整**: 返回数据包含4个核心节点

### 问题记录

| 问题ID | 场景ID | 问题描述 | 严重程度 | 解决建议 |
|--------|--------|----------|----------|----------|
| | | | 高/中/低 | |
| | | | | |
| | | | | |

### 执行总结

**测试环境**:
- Revit版本: _______
- MCP插件版本: _______
- 测试日期: _______
- 执行人员: _______

**整体评价**:
- □ 功能基本可用，建议发布
- □ 功能存在问题，需要修复
- □ 功能严重缺陷，不建议使用

**后续建议**:
- □ 继续进行性能测试
- □ 添加自动化脚本
- □ 补充边界条件测试
- □ 多版本兼容性测试

---

## 附录

### 快速故障排除

**常见问题及解决方法**:

1. **MCP命令无响应**
   - 检查外部工具是否正确加载
   - 重启Revit并重新加载插件

2. **参数设置失败**
   - 确认参数名称正确（注意中英文）
   - 检查参数是否为只读

3. **元素创建失败**
   - 验证typeId是否存在于项目中
   - 检查创建位置是否有冲突

4. **数据返回不完整**
   - 检查fields参数设置
   - 验证元素是否在当前视图可见

### 单位转换对照表

| 类型 | Revit内部单位 | 显示单位 | 转换系数 |
|------|-------------|----------|----------|
| 长度 | 英尺(ft) | 毫米(mm) | 1 ft = 304.8 mm |
| 角度 | 弧度(rad) | 度(°) | 1 rad = 57.2958° |
| 面积 | 平方英尺(ft²) | 平方米(m²) | 1 ft² = 0.092903 m² |

### 坐标系统说明

```
Revit坐标系统：
- X轴：东西方向（正X为东）
- Y轴：南北方向（正Y为北）
- Z轴：高程方向（正Z向上）
- 原点：项目基点或内部原点

单位：所有API返回的坐标值为毫米(mm)
```

### 节点验证Checklist

**identity节点**：
- [ ] name（元素名称）
- [ ] category（类别名称）
- [ ] elementId（元素ID）

**type节点**：
- [ ] typeId（类型ID）
- [ ] typeName（类型名称）
- [ ] familyId（族ID，仅族实例）
- [ ] familyName（族名称，仅族实例）

**geometry节点**：
- [ ] location.point 或 location.line
- [ ] boundingBox.min/max坐标
- [ ] 坐标值为毫米单位

**parameters节点**：

- [ ] instance子节点（实例参数）
- [ ] type子节点（类型参数，如果requested）
- [ ] 参数值类型正确

### E-01数据流验证详细步骤

1. **查询阶段**：
   ```json
   ai_element_filter({
     "data": {
       "filterCategory": "OST_Walls",
       "fields": ["identity", "geometry.location"]
     }
   })
   ```

2. **记录坐标**：
   ```
   记录第一面墙的geometry.location.line:
   p0: {x: ____, y: ____, z: ____}
   p1: {x: ____, y: ____, z: ____}
   ```

3. **视觉标记**：
   
   ```json
   operate_element_visual({
     "data": {
       "elementIds": [从步骤1获取的wallId],
       "visualAction": "Highlight"
     }
   })
   ```
   
4. **验证一致性**：
   ```
   □ 高亮的墙体位置与记录坐标一致
   □ 坐标值确为毫米单位
   □ 数据传递无错误
   ```

---

**文档版本**: v3.0 轻量版（最终修订）
**最后更新**: 2024年9月29日
**文档作者**: Claude AI Assistant
**审核状态**: 已根据专家建议完善